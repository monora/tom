
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Route Domain Model &#8212; Train Object Model 0.1.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="tom" href="modules.html" />
    <link rel="prev" title="Usage" href="usage.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="toctree-wrapper compound">
</div>
<div class="section" id="route-domain-model">
<h1>Route Domain Model<a class="headerlink" href="#route-domain-model" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Each international train has to be split into sections when the train crosses a border.  The split
locations are called handover points. At each handover the responsiblity for the train planning
changes from IM to IM and RU to RU. The planning process is coordinated by the lead RU.</p>
<p class="plantuml">
<img src="_images/plantuml-d565e148c9ad714493c485b8049b2ab805c011e0.png" alt="class JourneyLocation {
    id: LocationIdentifier
}
class Train {
    lead_ru: CompanyCode
}
class RouteSection {
    responsible_im: CompanyCode
    applicant_ ru: CompanyCode
}
Handover --|&gt; JourneyLocation
Origin --|&gt; JourneyLocation
Destination --|&gt; JourneyLocation

RouteSection -&gt; &quot;1&quot; JourneyLocation : origin &gt;
RouteSection -&gt; &quot;1&quot; JourneyLocation : destination &gt;
Train *--&gt; &quot;1..*&quot; RouteSection

class PathRequest {
    responsible_im: CompanyCode
    applicant_ ru: CompanyCode
}
PathRequest -&gt; &quot;1&quot; RouteSection : belongs to &gt;
"/>
</p>
<p>An international <a class="reference internal" href="tom.html#tom.tom.Train" title="tom.tom.Train"><code class="xref py py-class docutils literal notranslate"><span class="pre">Train</span></code></a> must at least have two sections. It then has exactly</p>
<ul class="simple">
<li>one origin</li>
<li>one destination</li>
<li>one or more handover journey locations</li>
</ul>
<p>For each <a class="reference internal" href="tom.html#tom.tom.RouteSection" title="tom.tom.RouteSection"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteSection</span></code></a> the responsible IM and applicant RU exchange
<em>PathRequest</em> and <em>PathDetails</em> to plan the detailed route within a <em>RouteSection</em>. This process is
described in detail in the <a class="reference external" href="http://taf-jsg.info/wp-content/uploads/2019/10/190604_js_handbook_2.0_with_xsd_2.2.3_0.pdf">Sector Handbook</a>.  As long as borders of a section both in location and
time are unchanged no other participant in the planning of the whole train has to be informed.</p>
<p>The following paragraph describes the minimal information which all companies involved must know
about the whole train. Changes to this information have to be propagated by the lead RU.</p>
</div>
<div class="section" id="train-and-routesection">
<h2>Train and RouteSection<a class="headerlink" href="#train-and-routesection" title="Permalink to this headline">¶</a></h2>
<p class="plantuml">
<img src="_images/plantuml-d91591b27a03af175412ba92e7c23a1f64c77191.png" alt="left to right direction

class Train {
    core: CoreID
    version: int
    lead_ru: CompanyCode

    +TrainID train_id()
}

class RouteSection {
    origin: JourneyLocation
    origin_departure_time: TimeOfDay
    stop_time: timedelta
    ---
    destination: JourneyLocation
    travel_time_to_destination: timedelta
    calendar: Set&lt;Date&gt;
    ---
    applicant_ru: CompanyCode
    responsible_im: CompanyCode
    ---
    section_id: int
    version: int = 1
    ---
    + str section_key()
}


Train *-- &quot;1..*&quot; RouteSection
"/>
</p>
<p>Only RouteSections have a calendar.  This is the set of starting days at origin.  All timestamps in
Train, TrainRun and SectionRuns are calculated from calendar, departure_at_origin, travel_time and
stop_time. No OTR (Offset To Reference) is needed!</p>
</div>
<div class="section" id="trainrun-and-sectionrun">
<h2>TrainRun and SectionRun<a class="headerlink" href="#trainrun-and-sectionrun" title="Permalink to this headline">¶</a></h2>
<p class="plantuml">
<img src="_images/plantuml-8a3585a40a518797115f1df294d11561f8d5783a.png" alt="left to right direction

class Train {
    lead_ru: CompanyCode
    +TrainID train_id()
}

class RouteSection {
    applicant_ru: CompanyCode
    responsible_im: CompanyCode

    origin_departure_time: TimeOfDay
    calendar: Set&lt;Date&gt;
}
Train *-- &quot;1..*&quot; RouteSection

class SectionRun {
    section_id: str

    departure_at_origin: Timestamp
    + Timestamp arrival_at_destination()
    + Timestamp arrival_at_origin()
    + JourneyLocation origin()
    + JourneyLocation destination()
    + Boolean connects_to(other: SectionRun)
}
RouteSection *- &quot;1..*&quot; SectionRun
note left of SectionRun
    A section run happens on the calendar day
    of its departure_at_origin timestamp.
end note

class TrainRun {
    + TrainID train_run_id()
    + Date start_date()
}
note right of TrainRun
    The start_date of train is the calendar day
    of the departure_at_origin timestamp of
    its first section run.
end note

TrainRun o-&gt; &quot;1..* {ordered}&quot; SectionRun
Train *- &quot;1..365&quot; TrainRun
"/>
</p>
</div>
<div class="section" id="example-train-from-amsterdam-to-frankfurt">
<h2>Example: Train from Amsterdam to Frankfurt<a class="headerlink" href="#example-train-from-amsterdam-to-frankfurt" title="Permalink to this headline">¶</a></h2>
<p class="plantuml">
<img src="_images/plantuml-0775244c9cbe05c6cc3beb0e4fb1a46efdb1677a.png" alt="object &quot;TR/1080/12AB: Train&quot; as tr
object &quot;AC-&gt;EMM: RouteSection&quot; as ac_emm
object &quot;AC-&gt;Venlo: RouteSection&quot; as ac_venlo
object &quot;EMM-&gt;FF: RouteSection&quot; as emm_ff
object &quot;Venlo-&gt;FF: RouteSection&quot; as venlo_ff

ac_emm : departure_at_origin = 23:50
ac_emm : travel_time = 02:10
ac_emm : calendar = [2021-12-01, 2021-12-31, Mon-Thu]

emm_ff : departure_at_origin = 02:00
emm_ff : travel_time = 10:00
emm_ff : calendar = [2021-12-02, 2021-12-31, Tue-Fri]

ac_venlo : departure_at_origin = 23:50
ac_venlo : travel_time = 02:05
ac_venlo : calendar = [2021-12-01, 2021-12-31, Fri-Sun]

venlo_ff : departure_at_origin = 02:00
venlo_ff : travel_time = 10:00
venlo_ff : stop_time = 00:05
venlo_ff : calendar = [2021-12-01, 2022-01-01, Sat-Mon]

tr *-- ac_emm
tr *-- ac_venlo
tr *-- emm_ff
tr *-- venlo_ff

ac_emm ..&gt; emm_ff : connects_to &gt;
ac_venlo ..&gt; venlo_ff : connects_to &gt;

note top of ac_venlo
    - First run on Fr 2021-12-01
    - Arrival in Venlo on Saturday 1:55 =&gt;
      calendar of Venlo-&gt;FF must start on Saturday
      (overnight)
end note
note left of venlo_ff
    - Train stops at Venlo for 5 minutes
    - Last SectionRun starts on Sa 2022-01-01!
end note

note as n1
    Another overnight between AC -&gt; EMM =&gt;
    must shift calendar of EMM-&gt;FF one day.
    A section calendar is always relative to the start
    at origin of the connected sections.
end note
n1 .. emm_ff
n1 .. ac_emm
"/>
</p>
<div class="section" id="yaml-example">
<h3>YAML-Example<a class="headerlink" href="#yaml-example" title="Permalink to this headline">¶</a></h3>
<div class="highlight-yaml notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">coreID</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">12AB</span>
<span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">sections</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">origin</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AC</span>
      <span class="nt">departure_time</span><span class="p">:</span> <span class="s">&#39;23:50:00&#39;</span>
      <span class="nt">destination</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">EMM</span>
      <span class="nt">travel_time</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">02:10:00</span>
      <span class="nt">calendar</span><span class="p">:</span>
        <span class="nt">begin</span><span class="p">:</span> <span class="nl">&amp;ac-begin</span> <span class="s">&#39;2021-12-01&#39;</span>
        <span class="nt">end</span><span class="p">:</span> <span class="nl">&amp;ac-end</span> <span class="s">&#39;2021-12-31&#39;</span>
        <span class="nt">mask</span><span class="p">:</span> <span class="s">&#39;Mon</span><span class="nv"> </span><span class="s">Tue</span><span class="nv"> </span><span class="s">Wed</span><span class="nv"> </span><span class="s">Thu&#39;</span>
    <span class="p p-Indicator">-</span> <span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
      <span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">origin</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">EMM</span>
      <span class="nt">departure_time</span><span class="p">:</span> <span class="nl">&amp;dep_time_emm</span> <span class="l l-Scalar l-Scalar-Plain">02:00:00</span>
      <span class="nt">destination</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FF</span>
      <span class="nt">travel_time</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10:00:00</span>
      <span class="nt">calendar</span><span class="p">:</span>
        <span class="nt">begin</span><span class="p">:</span> <span class="s">&#39;2021-12-02&#39;</span>
        <span class="nt">end</span><span class="p">:</span> <span class="nv">*ac-end</span>
        <span class="nt">mask</span><span class="p">:</span> <span class="s">&#39;Tue</span><span class="nv"> </span><span class="s">Wed</span><span class="nv"> </span><span class="s">Thu</span><span class="nv"> </span><span class="s">Fri&#39;</span>

    <span class="p p-Indicator">-</span> <span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
      <span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">origin</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AC</span>
      <span class="nt">departure_time</span><span class="p">:</span> <span class="s">&#39;23:50:00&#39;</span>
      <span class="nt">destination</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Venlo</span>
      <span class="nt">travel_time</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">02:05:00</span>
      <span class="nt">calendar</span><span class="p">:</span>
        <span class="nt">begin</span><span class="p">:</span> <span class="nv">*ac-begin</span>
        <span class="nt">end</span><span class="p">:</span> <span class="nv">*ac-end</span>
        <span class="nt">mask</span><span class="p">:</span> <span class="s">&#39;Fri</span><span class="nv"> </span><span class="s">Sat</span><span class="nv"> </span><span class="s">Sun&#39;</span>
    <span class="p p-Indicator">-</span> <span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
      <span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">origin</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Venlo</span>
      <span class="nt">departure_time</span><span class="p">:</span> <span class="nv">*dep_time_emm</span>
      <span class="nt">destination</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FF</span>
      <span class="nt">travel_time</span><span class="p">:</span> <span class="s">&#39;10:00:00&#39;</span>
      <span class="nt">stop_time</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">00:05:00</span>
      <span class="nt">calendar</span><span class="p">:</span>
        <span class="nt">begin</span><span class="p">:</span> <span class="nv">*ac-begin</span>
        <span class="nt">end</span><span class="p">:</span> <span class="s">&#39;2022-01-01&#39;</span>
        <span class="nt">mask</span><span class="p">:</span> <span class="s">&#39;Sat</span><span class="nv"> </span><span class="s">Sun</span><span class="nv"> </span><span class="s">Mon&#39;</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Train Object Model</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readme.html">Train Object Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Route Domain Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#train-and-routesection">Train and RouteSection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#trainrun-and-sectionrun">TrainRun and SectionRun</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example-train-from-amsterdam-to-frankfurt">Example: Train from Amsterdam to Frankfurt</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">tom</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">History</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="usage.html" title="previous chapter">Usage</a></li>
      <li>Next: <a href="modules.html" title="next chapter">tom</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Horst Duchene.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/domainmodel.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>