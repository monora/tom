

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Route Domain Model &mdash; Train Object Model 0.1.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="tom" href="modules.html" />
    <link rel="prev" title="Usage" href="usage.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Train Object Model
          

          
          </a>

          
            
            
              <div class="version">
                0.1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readme.html">Train Object Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Route Domain Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#train-and-routesection">Train and RouteSection</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#timestamps">Timestamps</a></li>
<li class="toctree-l3"><a class="reference internal" href="#identifiers">Identifiers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#versioning">Versioning</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#trainrun-and-sectionrun">TrainRun and SectionRun</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#sectionrun">SectionRun</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trainrun">TrainRun</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#example-train-from-amsterdam-to-frankfurt">Example: Train from Amsterdam to Frankfurt</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#specification-with-yaml">Specification with YAML</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trainrun-graph">TrainRun Graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="#timetable-as-excel-sheet">Timetable as Excel-Sheet</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#example-train-with-three-ims">Example: Train with three IMs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4">Specification with YAML</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">TrainRun Graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">Timetable as Excel-Sheet</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">tom</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">History</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Train Object Model</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Route Domain Model</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/domainmodel.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="toctree-wrapper compound">
</div>
<div class="section" id="route-domain-model">
<span id="routedomainmodel"></span><h1>Route Domain Model<a class="headerlink" href="#route-domain-model" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Each international train has to be split into sections when the train crosses a border.  The split
locations are called handover points. At each handover the responsibility for the train planning
changes from IM to IM and RU to RU. The planning process is coordinated by the <cite>Train.lead_ru</cite>.</p>
<p>This <a class="reference external" href="https://en.wikipedia.org/wiki/Class_diagram">UML</a> class diagramm <a class="footnote-reference" href="#f1" id="id1">[1]</a> shows the main concepts involved:</p>
<p class="plantuml">
<img src="_images/plantuml-1dc2d22755324fe0510a15982eb25c92f3e7d40e.png" alt="class JourneyLocation &lt;&lt;TOM&gt;&gt; {
    id: LocationIdentifier
}
class Train &lt;&lt;TOM&gt;&gt; {
    lead_ru: CompanyCode
}
class RouteSection {
    planning_im: CompanyCode
    applicant_ ru: CompanyCode
}
Handover --|&gt; JourneyLocation
Origin --|&gt; JourneyLocation
Destination --|&gt; JourneyLocation

RouteSection &quot;*&quot; -&gt; &quot;1&quot; JourneyLocation : departure_station &gt;
RouteSection &quot;*&quot; -&gt; &quot;1&quot; JourneyLocation : arrival_station &gt;
Train *-- &quot;1..*&quot; RouteSection

class PathRequest &lt;&lt;TOM&gt;&gt; {
    planning_im: CompanyCode
    applicant_ ru: CompanyCode
}
RouteSection o--  &quot;0..*&quot; PathRequest : is derived from &lt;
"/>
</p>
<p>An international <a class="reference internal" href="tom.html#tom.tom.Train" title="tom.tom.Train"><code class="xref py py-class docutils literal notranslate"><span class="pre">Train</span></code></a> <a class="footnote-reference" href="#f2" id="id2">[2]</a> must at least have two sections. The
following constraint must hold for each <a class="reference internal" href="tom.html#tom.tom.RouteSection" title="tom.tom.RouteSection"><code class="xref py py-class docutils literal notranslate"><span class="pre">RouteSection</span></code></a>:</p>
<div class="admonition-rule-sec-01-journey-locations admonition">
<p class="first admonition-title">Rule SEC-01 Journey Locations</p>
<ul class="last simple">
<li><cite>RouteSection.departure_station</cite> is a <em>Origin</em> or <em>Handover</em></li>
<li><cite>RouteSection.arrival_station</cite> is a <em>Handover</em> or <em>Destination</em></li>
</ul>
</div>
<p>For each <cite>RouteSection</cite> the <cite>planning_im</cite> and <cite>applicant_ru</cite> exchange <em>PathRequest</em> and
<em>PathDetails</em> to plan the detailed route within a <cite>RouteSection</cite>. This process is described in
detail in the <a class="reference external" href="http://taf-jsg.info/wp-content/uploads/2019/10/190604_js_handbook_2.0_with_xsd_2.2.3_0.pdf">Sector Handbook</a> of the RU/IM Telematrics <a class="reference external" href="http://taf-jsg.info/">JSG</a>.  As long as borders of a section
both in location and time are unchanged no other participant in the planning of the whole train has
to be informed.</p>
<p>The following paragraph describes the minimal information which all companies involved must know
about the whole train. Changes to this information have to be propagated by the lead RU.</p>
</div>
<div class="section" id="train-and-routesection">
<h2>Train and RouteSection<a class="headerlink" href="#train-and-routesection" title="Permalink to this headline">¶</a></h2>
<p>The following diagramm shows the two main classes of our proposition for the TOM. It describes the
minimum information needed for a valid route information of an international train:</p>
<p class="plantuml">
<img src="_images/plantuml-612f35165429e2e34012bab9e3ce6cad7b5d5889.png" alt="left to right direction

class Train {
    core: CoreID
    lead_ru: CompanyCode
    version: int

    +TrainID train_id()
}

class RouteSection {
    departure_station: JourneyLocation
    departure_time: TimeOfDay
    departure_stop_time: timedelta
    ---
    arrival_station: JourneyLocation
    travel_time: timedelta
    calendar: Set&lt;Date&gt;
    ---
    applicant_ru: CompanyCode
    planning_im: CompanyCode
    ---
    section_id: int
    version: int = 1
    ---
    + str section_key()
}

Train *-- &quot;1..*&quot; RouteSection
"/>
</p>
<div class="section" id="timestamps">
<h3>Timestamps<a class="headerlink" href="#timestamps" title="Permalink to this headline">¶</a></h3>
<p>This model completely describes a planned set of <em>train runs</em>. Each train run is a sequence of
<em>sections runs</em> which have to connect properly in time at handover points. The timing attributes of
a <cite>RouteSection</cite> serve this purpose:</p>
<ul class="simple">
<li><cite>calendar</cite> is a set of calendar days where the train starts at <cite>RouteSection.departure_station</cite></li>
<li><cite>departure_time</cite> is the day time the train starts each day in <cite>calendar</cite></li>
<li><cite>departure_stop_time</cite> planned stop time at a section handover station of departure</li>
<li><cite>travel_time</cite> travel time from section station of departure to section station
of arrival. This attribute is used to calculate the arrival time at station of arrival.</li>
</ul>
<p>Only RouteSections have a calendar.  This is the set of starting days at the departure_station of a section.
All timestamps in Train, TrainRun and SectionRuns (see next chapter) are calculated from the timing
attributes.</p>
<div class="admonition-rule-sec-02-routesection-calendar-must-be-subset-of-timetable-year admonition">
<p class="first admonition-title">Rule SEC-02 RouteSection Calendar must be subset of timetable year</p>
<p class="last">The <cite>RouteSection.calendar</cite> must be a subset of the timetable year of its train.</p>
</div>
<p>Because a train can have several starting RouteSections (i.e. different start locations and dates)
it makes no sense to assign a calender to it. A calender must always be relativ to a fixed start
location. <a class="reference internal" href="#example-ac-ff"><span class="std std-ref">Example: Train from Amsterdam to Frankfurt</span></a> explains such a situation with an overnight train in the starting
sections.</p>
<p>Working with only timestamps also avoids the difficulties with overnight trains. No OTR (<em>Offset To
Reference</em>) is needed!</p>
</div>
<div class="section" id="identifiers">
<h3>Identifiers<a class="headerlink" href="#identifiers" title="Permalink to this headline">¶</a></h3>
<p>The method Train <a class="reference internal" href="tom.html#tom.tom.Train.train_id" title="tom.tom.Train.train_id"><code class="xref py py-meth docutils literal notranslate"><span class="pre">train_id()</span></code></a> computes the unique trainID from <cite>core_id</cite>, <cite>lead_ru</cite> and
<cite>timetable_year</cite>.</p>
<div class="admonition-rule-sec-03-unique-section-id admonition">
<p class="first admonition-title">Rule SEC-03 Unique Section ID</p>
<p class="last"><a class="reference internal" href="tom.html#tom.tom.RouteSection.section_id" title="tom.tom.RouteSection.section_id"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RouteSection.section_id</span></code></a> must be unique within the set
of sections of a train.</p>
</div>
<p>The <cite>section_id</cite> is used to make the daily train IDs unique in case of overnight trains. Using the
start date of a train results in duplicate train IDs. See example below.</p>
<div class="admonition-rule-sec-04-unique-functional-key-of-sections admonition">
<p class="first admonition-title">Rule SEC-04 Unique functional key of sections</p>
<p>A route section of a train is uniquely identified by this quadruple:</p>
<p class="last"><cite>((section.departure_station, section.departure_time), (section.arrival_station, section.arrival_time))</cite></p>
</div>
<p>Therefore, if on some day in the calendar of a section the train from section station of departure
<cite>AC</cite> to section station of arrival <cite>EMM</cite>
should arrive at at different time at <cite>EMM</cite>, the RU has to define a new RouteSection for
this day. If <cite>EMM</cite> is a handover, the lead RU must ask the applicant RU of the following section to
create fitting route section with section station of departure <cite>EMM</cite>.</p>
</div>
<div class="section" id="versioning">
<h3>Versioning<a class="headerlink" href="#versioning" title="Permalink to this headline">¶</a></h3>
<p>We suggest <em>versioning</em> of trains and sections to support the synchronsisation of the domain model
between the systems of the cooperating companies. If a company make a change of section its
<cite>RouteSection.version</cite> is incremented. Same with the <cite>Train.version</cite>. The receiver of a message
containing the RoutingInfo <a class="footnote-reference" href="#f3" id="id3">[3]</a> can use this information to identify the change and act
accordingly.</p>
</div>
</div>
<div class="section" id="trainrun-and-sectionrun">
<h2>TrainRun and SectionRun<a class="headerlink" href="#trainrun-and-sectionrun" title="Permalink to this headline">¶</a></h2>
<p>In this section we describe, how the daily train and section runs are computed from the routing
info of a <cite>Train</cite> described in the previous section.</p>
<ul class="simple">
<li>A <a class="reference internal" href="tom.html#tom.tom.SectionRun" title="tom.tom.SectionRun"><code class="xref py py-class docutils literal notranslate"><span class="pre">SectionRun</span></code></a> is derived for each day in the calendar of its <cite>RouteSection</cite></li>
<li>A <a class="reference internal" href="tom.html#tom.tom.TrainRun" title="tom.tom.TrainRun"><code class="xref py py-class docutils literal notranslate"><span class="pre">TrainRun</span></code></a> is computed from SectionRuns that <em>fit</em> together. Two sections <cite>s, t</cite>
fit together if <cite>s.connects_to(t) == True</cite> (see <a class="reference internal" href="tom.html#tom.tom.SectionRun.connects_to" title="tom.tom.SectionRun.connects_to"><code class="xref py py-meth docutils literal notranslate"><span class="pre">connects_to()</span></code></a>).</li>
</ul>
<p class="plantuml">
<img src="_images/plantuml-e8b3482207f2804e7581eb48d55736179a2b3329.png" alt="left to right direction

class Train &lt;&lt;TOM&gt;&gt; {
    lead_ru: CompanyCode
    +TrainID train_id()
}

class RouteSection {
    applicant_ru: CompanyCode
    planning_im: CompanyCode

    departure_time: TimeOfDay
    calendar: Set&lt;Date&gt;
}
Train *-- &quot;1..*&quot; RouteSection

class SectionRun {

    departure_time: Timestamp
    + str section_id()
    + Timestamp arrival_time()
    + Timestamp arrival_at_departure_station()
    + JourneyLocation departure_station()
    + JourneyLocation arrival_station()
    + Boolean connects_to(other: SectionRun)
}
RouteSection *- &quot;1..*&quot; SectionRun
note bottom of SectionRun
    A section run happens on the calendar day
    of its departure_time timestamp.
end note

class TrainRun {
    + TrainID train_run_id()
    + Date start_date()
}
note bottom of TrainRun
    The start_date of a train run is the calendar day
    of the departure_time timestamp of
    its first section run.
end note

TrainRun o--&gt; &quot;1..* {ordered}&quot; SectionRun
Train o- &quot;1..365&quot; TrainRun
"/>
</p>
<div class="section" id="sectionrun">
<h3>SectionRun<a class="headerlink" href="#sectionrun" title="Permalink to this headline">¶</a></h3>
<p>For each day in day in <cite>RouteSection.calendar</cite> a section run is created. All <cite>SectionRuns</cite> of a
section differ only in the value of <code class="xref py py-meth docutils literal notranslate"><span class="pre">departure_time()</span></code>, which is the only
information stored in a SectionRun. All other values shown can be computed from this timestamp and
the attributes of the section the run belongs to.</p>
</div>
<div class="section" id="trainrun">
<h3>TrainRun<a class="headerlink" href="#trainrun" title="Permalink to this headline">¶</a></h3>
<p>Whereas the section runs can easily computed from information in its RouteSection (mainly calendar
and departure time at section station of departure), the train runs must be computed from all
possible SectionRun sequences that fit together.</p>
<p>We use a graph algorithm to compute all train runs. The graph used is best described by the examples
shown below. The central methods are:</p>
<ul class="simple">
<li><a class="reference internal" href="tom.html#tom.tom.Train.train_run_graph" title="tom.tom.Train.train_run_graph"><code class="xref py py-meth docutils literal notranslate"><span class="pre">train_run_graph()</span></code></a> which computes a directed Graph G = (SectionRun, E), where
(s,t) in E &lt;=&gt; s.connects_to(t).</li>
<li><a class="reference internal" href="tom.html#tom.tom.Train.extended_train_run_graph" title="tom.tom.Train.extended_train_run_graph"><code class="xref py py-meth docutils literal notranslate"><span class="pre">extended_train_run_graph()</span></code></a> which adds to synthetic vertices to G, one at the
beginning (<cite>START</cite>) connecting to departure stations of SectionRuns and one at the end (<cite>END</cite>)
which connects to all stations of arrival of SectionRuns.</li>
<li><a class="reference internal" href="tom.html#tom.tom.Train.train_run_iterator" title="tom.tom.Train.train_run_iterator"><code class="xref py py-meth docutils literal notranslate"><span class="pre">train_run_iterator()</span></code></a> which computes all TrainRuns out of all path in G from
<cite>START</cite> to <cite>END</cite>.</li>
</ul>
</div>
</div>
<div class="section" id="example-train-from-amsterdam-to-frankfurt">
<span id="example-ac-ff"></span><h2>Example: Train from Amsterdam to Frankfurt<a class="headerlink" href="#example-train-from-amsterdam-to-frankfurt" title="Permalink to this headline">¶</a></h2>
<p>Given this infrastructure:</p>
<p class="plantuml">
<img src="_images/plantuml-1edd99643aece3d8cbc7dd4128ff476949fcc71c.png" alt="package Prorail &lt;&lt;Rectangle&gt;&gt; {
    object &quot;Amsterdam Central&quot; as ac
    ac : AC
}
package &quot;DB Netz&quot; &lt;&lt;Rectangle&gt;&gt; {
    object &quot;Frankfurt&quot; as ff
    ff : FF
}
package &quot;Handovers&quot; &lt;&lt;Rectangle&gt;&gt; {
    object Venlo
    object &quot;Emmerich&quot; as emm
    emm : EMM
}

ac - emm
ac - Venlo
Venlo - ff
emm - ff
Venlo --[hidden] emm
"/>
</p>
<p>This object diagramm shows a szenario for a train from AC to Frankfurt FF
which is planned to operate in december 2021. On Fri-Sun handover is EMM. On Mon-Thu
handover is Venlo.</p>
<p class="plantuml">
<img src="_images/plantuml-37b381b9a40a7f1d1a4b1afe854e0d8ee3998969.png" alt="object &quot;TR/1080/12AB: Train&quot; as tr
object &quot;AC-&gt;EMM: RouteSection&quot; as ac_emm
object &quot;AC-&gt;Venlo: RouteSection&quot; as ac_venlo
object &quot;EMM-&gt;FF: RouteSection&quot; as emm_ff
object &quot;Venlo-&gt;FF: RouteSection&quot; as venlo_ff

ac_emm : departure_time = 23:50
ac_emm : travel_time = 02:10
ac_emm : calendar = [2021-12-01, 2021-12-31, Mon-Thu]

emm_ff : departure_time = 02:00
emm_ff : travel_time = 10:00
emm_ff : calendar = [2021-12-02, 2021-12-31, Tue-Fri]

ac_venlo : departure_time = 23:50
ac_venlo : travel_time = 02:05
ac_venlo : calendar = [2021-12-01, 2021-12-31, Fri-Sun]

venlo_ff : departure_time = 02:00
venlo_ff : travel_time = 10:00
venlo_ff : stop_time = 00:05
venlo_ff : calendar = [2021-12-01, 2022-01-01, Sat-Mon]

tr *-- ac_emm
tr *-- ac_venlo
tr *-- emm_ff
tr *-- venlo_ff

ac_emm ..&gt; emm_ff : connects_to &gt;
ac_venlo ..&gt; venlo_ff : connects_to &gt;

note top of ac_venlo
    - First run on Fr 2021-12-01
    - Arrival in Venlo on Saturday 1:55 =&gt;
      calendar of Venlo-&gt;FF must start on Saturday
      (overnight)
end note
note left of venlo_ff
    - Train stops at Venlo for 5 minutes
    - Last SectionRun starts on Sa 2022-01-01!
end note

note as n1
    Another overnight between AC -&gt; EMM =&gt;
    must shift calendar of EMM-&gt;FF one day.
    A section calendar is always relative to the start
    at station of departure of the connected sections.
end note
n1 .. emm_ff
n1 .. ac_emm
"/>
</p>
<div class="section" id="specification-with-yaml">
<h3>Specification with YAML<a class="headerlink" href="#specification-with-yaml" title="Permalink to this headline">¶</a></h3>
<p>The following YAML-file is a machine readable specification of the route sections of a train with
CoreID <cite>12AB</cite>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">coreID</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">12AB</span>
<span class="nt">lead_ru</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1080</span> <span class="c1"># DB FV</span>
<span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">sections</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">applicant_ru</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1084</span> <span class="c1"># NS</span>
      <span class="nt">planning_im</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0084</span> <span class="c1"># Prorail</span>
      <span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">departure_station</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AC</span>
      <span class="nt">departure_time</span><span class="p">:</span> <span class="s">&#39;23:50:00&#39;</span>
      <span class="nt">arrival_station</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">EMM</span>
      <span class="nt">travel_time</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">02:10:00</span>
      <span class="nt">calendar</span><span class="p">:</span>
        <span class="nt">begin</span><span class="p">:</span> <span class="nl">&amp;ac-begin</span> <span class="s">&#39;2021-12-01&#39;</span>
        <span class="nt">end</span><span class="p">:</span> <span class="nl">&amp;ac-end</span> <span class="s">&#39;2021-12-31&#39;</span>
        <span class="nt">mask</span><span class="p">:</span> <span class="s">&#39;Mon</span><span class="nv"> </span><span class="s">Tue</span><span class="nv"> </span><span class="s">Wed</span><span class="nv"> </span><span class="s">Thu&#39;</span>
    <span class="p p-Indicator">-</span> <span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
      <span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">applicant_ru</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1080</span> <span class="c1"># DB FV</span>
      <span class="nt">planning_im</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0080</span> <span class="c1"># DB Netz</span>
      <span class="nt">departure_station</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">EMM</span>
      <span class="nt">departure_time</span><span class="p">:</span> <span class="nl">&amp;dep_time_emm</span> <span class="l l-Scalar l-Scalar-Plain">02:00:00</span>
      <span class="nt">arrival_station</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FF</span>
      <span class="nt">travel_time</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10:00:00</span>
      <span class="nt">calendar</span><span class="p">:</span>
        <span class="nt">begin</span><span class="p">:</span> <span class="s">&#39;2021-12-02&#39;</span> <span class="c1"># shifted by one day relativ to AC-EMM</span>
        <span class="nt">end</span><span class="p">:</span> <span class="nv">*ac-end</span>        <span class="c1"># substituted by &amp;ac-end</span>
        <span class="nt">mask</span><span class="p">:</span> <span class="s">&#39;Tue</span><span class="nv"> </span><span class="s">Wed</span><span class="nv"> </span><span class="s">Thu</span><span class="nv"> </span><span class="s">Fri&#39;</span>

    <span class="p p-Indicator">-</span> <span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
      <span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">applicant_ru</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1084</span> <span class="c1"># NS</span>
      <span class="nt">planning_im</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0084</span> <span class="c1"># Prorail</span>
      <span class="nt">departure_station</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">AC</span>
      <span class="nt">departure_time</span><span class="p">:</span> <span class="s">&#39;23:50:00&#39;</span>
      <span class="nt">arrival_station</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Venlo</span>
      <span class="nt">travel_time</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">02:05:00</span>
      <span class="nt">calendar</span><span class="p">:</span>
        <span class="nt">begin</span><span class="p">:</span> <span class="nv">*ac-begin</span>
        <span class="nt">end</span><span class="p">:</span> <span class="nv">*ac-end</span>
        <span class="nt">mask</span><span class="p">:</span> <span class="s">&#39;Fri</span><span class="nv"> </span><span class="s">Sat</span><span class="nv"> </span><span class="s">Sun&#39;</span>
    <span class="p p-Indicator">-</span> <span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
      <span class="nt">version</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">applicant_ru</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1080</span> <span class="c1"># DB FV</span>
      <span class="nt">planning_im</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0080</span> <span class="c1"># DB Netz</span>
      <span class="nt">departure_station</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Venlo</span>
      <span class="nt">departure_time</span><span class="p">:</span> <span class="nv">*dep_time_emm</span>
      <span class="nt">arrival_station</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">FF</span>
      <span class="nt">travel_time</span><span class="p">:</span> <span class="s">&#39;10:00:00&#39;</span>
      <span class="nt">stop_time</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">00:05:00</span>
      <span class="nt">calendar</span><span class="p">:</span>
        <span class="nt">begin</span><span class="p">:</span> <span class="nv">*ac-begin</span>
        <span class="c1"># Must include 1.1. for last section run</span>
        <span class="nt">end</span><span class="p">:</span> <span class="s">&#39;2022-01-01&#39;</span>
        <span class="nt">mask</span><span class="p">:</span> <span class="s">&#39;Sat</span><span class="nv"> </span><span class="s">Sun</span><span class="nv"> </span><span class="s">Mon&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="trainrun-graph">
<h3>TrainRun Graph<a class="headerlink" href="#trainrun-graph" title="Permalink to this headline">¶</a></h3>
<p>The resulting <em>TrainRun-Graph</em> can be calculated with
<a class="reference internal" href="tom.html#tom.tom.Train.extended_train_run_graph" title="tom.tom.Train.extended_train_run_graph"><code class="xref py py-meth docutils literal notranslate"><span class="pre">extended_train_run_graph()</span></code></a> and looks like this:</p>
<div class="figure" id="id7">
<img alt="Example train run graph" src="_images/example-ac-ff-train-run-graph.png" />
<p class="caption"><span class="caption-text">TrainRun Graph Example Amsterdam to Frankfurt</span></p>
</div>
<p>You can download this graph as <a class="reference external" href="https://de.wikipedia.org/wiki/GraphML">GraphML</a> here: <a class="reference download internal" download="" href="_downloads/47e4598cfaeb4e804114daaac2d9fa26/train-TR-12AB-1.graphml"><code class="xref download docutils literal notranslate"><span class="pre">examples/train-TR-12AB-1.graphml</span></code></a>.</p>
</div>
<div class="section" id="timetable-as-excel-sheet">
<h3>Timetable as Excel-Sheet<a class="headerlink" href="#timetable-as-excel-sheet" title="Permalink to this headline">¶</a></h3>
<p>With <a class="reference internal" href="tom.html#tom.tom.Train.to_dataframe" title="tom.tom.Train.to_dataframe"><code class="xref py py-meth docutils literal notranslate"><span class="pre">to_dataframe()</span></code></a> you can create a <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.html">Pandas DataFrame</a> which you can export
to excel representing the time table of the train. See <a class="reference download internal" download="" href="_downloads/74e7ce4d1d7f0a2ed9c241e9cf246925/train-TR-12AB-1.xlsx"><code class="xref download docutils literal notranslate"><span class="pre">examples/train-TR-12AB-1.xlsx</span></code></a>.</p>
</div>
</div>
<div class="section" id="example-train-with-three-ims">
<span id="example-a-f"></span><h2>Example: Train with three IMs<a class="headerlink" href="#example-train-with-three-ims" title="Permalink to this headline">¶</a></h2>
<p>Given this infrastructure:</p>
<p class="plantuml">
<img src="_images/plantuml-342eb86d58542f676555a1bb922df5e7be2a4262.png" alt="package IMa &lt;&lt;Rectangle&gt;&gt; {
    object A
    object B
}
object C
C : Handover

package IMb &lt;&lt;Rectangle&gt;&gt; {
    object D
}

object E
E : Handover

package IMc &lt;&lt;Rectangle&gt;&gt; {
    object F
    object G
}

A - B
B - C
C - D
D - E
E - F
F - G
"/>
</p>
<p>This object diagramm shows a szenario for a train from A,B to F,G which is planned to operate in
december 2020.</p>
<p class="plantuml">
<img src="_images/plantuml-a62c9e541bd2011a77594a4084ba5f33de6dfe76.png" alt="object &quot;TR/1080/13AB: Train&quot; as tr
object &quot;A-&gt;C: RouteSection&quot; as ac
object &quot;B-&gt;C: RouteSection&quot; as bc
object &quot;C-&gt;E: RouteSection&quot; as ce
object &quot;E-&gt;F: RouteSection&quot; as ef
object &quot;E-&gt;G: RouteSection&quot; as eg

ac : departure_time = 23:30
ac : travel_time = 02:00
ac : calendar = [2020-12-01, 2020-12-31, Sat]

bc : departure_time = 00:30
bc : travel_time = 01:00
bc : calendar = [2020-12-01, 2020-12-31, Mon-Sat]

ce : departure_time = 01:30
ce : travel_time = 23:00
ce : calendar = [2020-12-01, 2020-12-31, daily]

ef : departure_time = 00:30
ef : travel_time = 04:00
ef : calendar = [2020-12-02, 2021-01-01, Wed-Mon]

eg : departure_time = 00:30
eg : travel_time = 08:00
eg : calendar = [2020-12-02, 2021-01-01, Tue]

tr --&gt; ac : begin_section &gt;
tr --&gt; bc : begin_section &gt;

ac ..&gt; ce : connects_to &gt;
bc ..&gt; ce : connects_to &gt;
ce ..&gt; ef : connects_to &gt;
ce ..&gt; eg : connects_to &gt;

note top of ac
    Section starts previous day (night shift).
    This train passes B at 00:30 on Sundays.
    Therefore calender at start must be saturdays.
end note

note as n1
    calendar validity starts 2.12.2011 because of double night shift
    and last until 1.1.2021 (last section run starts ini new year)

end note

ef &lt;.. n1
eg &lt;.. n1
"/>
</p>
<div class="section" id="id4">
<h3>Specification with YAML<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">coreID</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">13AB</span>
<span class="nt">sections</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">departure_station</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">B</span>
      <span class="nt">departure_time</span><span class="p">:</span> <span class="nl">&amp;b-departure</span> <span class="s">&#39;00:30:00&#39;</span>
      <span class="nt">arrival_station</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C</span>
      <span class="nt">travel_time</span><span class="p">:</span> <span class="s">&#39;01:00:00&#39;</span>
      <span class="nt">calendar</span><span class="p">:</span>
        <span class="nt">begin</span><span class="p">:</span> <span class="nl">&amp;b-begin</span> <span class="s">&#39;2020-12-01&#39;</span>
        <span class="nt">end</span><span class="p">:</span> <span class="nl">&amp;b-end</span> <span class="s">&#39;2020-12-31&#39;</span>
        <span class="c1"># Sundays the train starting from A passes B</span>
        <span class="nt">mask</span><span class="p">:</span> <span class="s">&#39;Mon</span><span class="nv"> </span><span class="s">Tue</span><span class="nv"> </span><span class="s">Wed</span><span class="nv"> </span><span class="s">Thu</span><span class="nv"> </span><span class="s">Fri</span><span class="nv"> </span><span class="s">Sat&#39;</span>
      <span class="nt">section_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="p p-Indicator">-</span> <span class="nt">departure_station</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">A</span>
      <span class="nt">departure_time</span><span class="p">:</span> <span class="s">&#39;23:30:00&#39;</span>
      <span class="nt">arrival_station</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C</span>
      <span class="nt">travel_time</span><span class="p">:</span> <span class="s">&#39;02:00:00&#39;</span>
      <span class="nt">calendar</span><span class="p">:</span>
        <span class="nt">begin</span><span class="p">:</span> <span class="nv">*b-begin</span>
        <span class="nt">end</span><span class="p">:</span> <span class="nv">*b-end</span>
        <span class="c1"># Sunday in B =&gt; Saturday start in A</span>
        <span class="nt">mask</span><span class="p">:</span> <span class="s">&#39;Sat&#39;</span>
      <span class="nt">section_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
    <span class="p p-Indicator">-</span> <span class="nt">departure_station</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">C</span>
      <span class="nt">departure_time</span><span class="p">:</span> <span class="s">&#39;01:30:00&#39;</span>
      <span class="nt">arrival_station</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">E</span>
      <span class="nt">travel_time</span><span class="p">:</span> <span class="s">&#39;23:00:00&#39;</span>
      <span class="nt">calendar</span><span class="p">:</span>
        <span class="nt">begin</span><span class="p">:</span> <span class="nv">*b-begin</span>
        <span class="nt">end</span><span class="p">:</span> <span class="nv">*b-end</span>
        <span class="c1"># no mask =&gt; daily</span>
      <span class="nt">section_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
    <span class="p p-Indicator">-</span> <span class="nt">departure_station</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">E</span>
      <span class="nt">departure_time</span><span class="p">:</span> <span class="nv">*b-departure</span>
      <span class="nt">arrival_station</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">F</span>
      <span class="nt">travel_time</span><span class="p">:</span> <span class="s">&#39;04:00:00&#39;</span>
      <span class="nt">calendar</span><span class="p">:</span>
        <span class="c1"># 1.12. must be be excluded und 1.1. included</span>
        <span class="nt">begin</span><span class="p">:</span> <span class="nl">&amp;e-begin</span> <span class="s">&#39;2020-12-02&#39;</span>
        <span class="nt">end</span><span class="p">:</span> <span class="nl">&amp;e-end</span> <span class="s">&#39;2021-01-01&#39;</span>
        <span class="c1"># Not on tuesday. On tuesdays section E-G is used.</span>
        <span class="nt">mask</span><span class="p">:</span> <span class="s">&#39;Wed</span><span class="nv"> </span><span class="s">Thu</span><span class="nv"> </span><span class="s">Fri</span><span class="nv"> </span><span class="s">Sat</span><span class="nv"> </span><span class="s">Sun</span><span class="nv"> </span><span class="s">Mon&#39;</span>
      <span class="nt">section_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">4</span>
    <span class="p p-Indicator">-</span> <span class="nt">departure_station</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">E</span>
      <span class="nt">departure_time</span><span class="p">:</span> <span class="nv">*b-departure</span>
      <span class="nt">arrival_station</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">G</span>
      <span class="nt">travel_time</span><span class="p">:</span> <span class="s">&#39;08:00:00&#39;</span>
      <span class="nt">calendar</span><span class="p">:</span>
        <span class="nt">begin</span><span class="p">:</span> <span class="nv">*e-begin</span>
        <span class="nt">end</span><span class="p">:</span> <span class="nv">*e-end</span>
        <span class="nt">mask</span><span class="p">:</span> <span class="s">&#39;Tue&#39;</span>
      <span class="nt">section_id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>TrainRun Graph<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="figure">
<img alt="Example train run graph" src="_images/example-a-f-train-run-graph.png" />
</div>
<p>You can see 4 train runs starting from A, 31-4 starting from B, 4 arriving in G and 31-4 arriving
in F.</p>
<p>You can download this graph as <a class="reference external" href="https://de.wikipedia.org/wiki/GraphML">GraphML</a> here: <a class="reference download internal" download="" href="_downloads/7737e967ae7ddcf9e6d6bb0bdb7bf884/train-TR-13AB-1.graphml"><code class="xref download docutils literal notranslate"><span class="pre">examples/train-TR-13AB-1.graphml</span></code></a>.</p>
</div>
<div class="section" id="id6">
<h3>Timetable as Excel-Sheet<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>Download the time table for <cite>Train-13AB</cite> here: <a class="reference download internal" download="" href="_downloads/d363e50a1aed2e0743c6a57340a9c609/train-TR-13AB-1.xlsx"><code class="xref download docutils literal notranslate"><span class="pre">examples/train-TR-13AB-1.xlsx</span></code></a>.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>We use <a class="reference external" href="https://plantuml.com/en/class-diagram">PlantUML</a> as modeling tool. See explanations there.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Click on the link to see the python source code for the code element</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>Train and RouteSections could be transported in the TAF/TAP <cite>TrainInformation</cite> message
structure.</td></tr>
</tbody>
</table>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="modules.html" class="btn btn-neutral float-right" title="tom" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="usage.html" class="btn btn-neutral float-left" title="Usage" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Horst Duchene

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>